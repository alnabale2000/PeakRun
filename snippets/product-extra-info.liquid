{%- comment -%}
  ÙŠØ¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù€ Metafields Ùˆ Metaobject
  ØªØ£ÙƒØ¯ Ù…Ù† namespace (Ø­Ø§Ù„ÙŠØ§Ù‹ Ù…Ø³ØªØ®Ø¯Ù… custom.*).
{%- endcomment -%}

{%- assign sustainability = product.metafields.custom.sustainability_score -%}
{%- assign care = product.metafields.custom.care_instructions -%}
{%- assign fabric = product.metafields.custom.fabric_composition -%}
{%- assign size_obj = product.metafields.custom.size_chart_reference.value -%}

<div class="ProductExtraInfo" id="ProductExtraInfo">
  {%- if sustainability %}
    {%- assign score = sustainability | plus: 0 -%}
    {%- comment %}
      ØªØ¯Ø±Ù‘Ø¬ Ø£Ù„ÙˆØ§Ù† Ø¨Ø³ÙŠØ·:
      0-3 Ø£Ø­Ù…Ø±ØŒ 4-6 Ø£ØµÙØ±ØŒ 7-10 Ø£Ø®Ø¶Ø±
    {%- endcomment %}
    {%- if score <= 3 -%}
      {%- assign badge_color = 'is-low' -%}
    {%- elsif score <= 6 -%}
      {%- assign badge_color = 'is-mid' -%}
    {%- else -%}
      {%- assign badge_color = 'is-high' -%}
    {%- endif -%}

    <div class="PEI-row">
      <span class="PEI-label">Sustainability:</span>
      <span class="PEI-badge {{ badge_color }}">{{ score }}</span>
    </div>
  {%- endif %}

  {%- if fabric %}
    <div class="PEI-row">
      <span class="PEI-label">Fabric:</span>
      <span class="PEI-text">{{ fabric }}</span>
    </div>
  {%- endif %}

  {%- if care %}
    <div class="PEI-accordion" data-accordion>
      <button type="button" class="PEI-accordion__trigger" aria-expanded="false">
        <span>Care Instructions</span>
        <span class="PEI-accordion__icon" aria-hidden="true">+</span>
      </button>
      <div class="PEI-accordion__panel" hidden>
        <pre class="PEI-care-text">{{ care }}</pre>
      </div>
    </div>
  {%- endif %}

  {%- if size_obj %}
    <div class="PEI-sizechart" data-sizechart>
      <button type="button" class="PEI-sizechart__trigger" aria-expanded="false">
        <span>Size Chart</span>
        <span class="PEI-sizechart__icon" aria-hidden="true">ğŸ“</span>
      </button>
      <div class="PEI-sizechart__panel" hidden>
        <ul class="PEI-sizechart__meta">
          {%- if size_obj.category %}
            <li><strong>Category:</strong> {{ size_obj.category }}</li>
          {% endif %}
          {%- if size_obj.gender %}
            <li><strong>Gender:</strong> {{ size_obj.gender }}</li>
          {% endif %}
          {%- if size_obj.unit_system %}
            <li><strong>Unit System:</strong> {{ size_obj.unit_system }}</li>
          {% endif %}
          {%- if size_obj.region %}
            <li><strong>Region:</strong> {{ size_obj.region }}</li>
          {% endif %}
          {%- if size_obj.fit_tip %}
            <li><strong>Fit tip:</strong> {{ size_obj.fit_tip }}</li>
          {% endif %}
          {%- if size_obj.notes %}
            <li><strong>Notes:</strong> {{ size_obj.notes }}</li>
          {% endif %}
          {%- if size_obj.last_updated %}
            <li><strong>Updated:</strong> {{ size_obj.last_updated | date: '%Y-%m-%d' }}</li>
          {% endif %}
        </ul>
      </div>
    </div>
  {%- endif %}
</div>

<script>
  (function () {
    function init(scope) {
      if (!scope) scope = document;
      // ÙƒÙ„ Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ†Ø§Øª (Ø§Ù„Ø¹Ù†Ø§ÙŠØ© ÙˆØ§Ù„Ù…Ù‚Ø§Ø³Ø§Øª)
      scope.querySelectorAll('[data-accordion], [data-sizechart]').forEach(function (wrapper) {
        const btn = wrapper.querySelector('button');
        const panel = wrapper.querySelector('[class$="__panel"]');
        if (!btn || !panel) return;

        // Ù„Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø«
        if (btn.dataset.peiBound === '1') return;
        btn.dataset.peiBound = '1';

        btn.addEventListener('click', function () {
          const expanded = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', String(!expanded));
          panel.hidden = expanded;

          const icon = btn.querySelector('.PEI-accordion__icon, .PEI-sizechart__icon');
          if (icon) {
            // Ø¨Ø¯Ù‘Ù„ Ø§Ù„Ø±Ù…Ø² + â†” âˆ’
            if (icon.textContent.trim() === '+') icon.textContent = 'âˆ’';
            else if (icon.textContent.trim() === 'âˆ’') icon.textContent = '+';
          }
        });
      });
    }

    // ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±
    init(document);

    // Ø¯Ø¹Ù… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ Theme Editor
    document.addEventListener('shopify:section:load', function (e) {
      init(e.target);
    });
  })();
</script>
